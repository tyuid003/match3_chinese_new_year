# Match3 Chinese New Year

Cloudflare Pages + D1 setup.

## D1 Schema
Run the SQL in `schema.sql` on your D1 database.

## Bindings
Update `wrangler.toml` with your D1 database ID.

## Deploy
1) Create a D1 database named `match3_scores`.
2) Apply schema from `schema.sql`.
3) Deploy with Cloudflare Pages (Functions folder is auto-detected).

## API
- POST `/api/score` { firstName, lastName, phone, score }
- GET `/api/leaderboard?limit=10`


1.หน้าแอดมินจะมีช่องออกลิ้งก์สำหรับให้ลูกค้าเล่นเกม
- แอดมินกรอก USER_ID , ชื่อ-นามสกุล , เบอร์โทรศัพท์ ของลูกค้า แล้วบันทึกข้อมูลลงD1
- ออกลิ้งเช่น https://example.com/play?u={USER_ID}
- ปุ่มคิดลอกลิ้งก์ (เพื่อไว้ส่งให้ลูกค้า)
- ตารางแสดงรายชื่อลูกค้า สามารถกดแก้ไขชื่อนามสกุล เบอรโทรลูกค้าได้ (กรณีใส่ผิด) แก้สกอร์ได้เผื่อเกิดข้อผิดพลาด สามารถลบรายชื่อออกได้

2.หลังจากลูกค้าเล่นจบ ให้บันทึกสกอร์ลูกค้าตามยูสเซอร์ที่บันทึกไว้ในข้อ 1
- พร้อมใส่ finish:true ลงในฐานข้อมูลเพื่อเป็นเงื่อนไขว่าลูกค้าจะรับรางวัลได้รอบเดียวแต่จะเล่นเกมใหม่กี่ครั้งก็ได้

3.หลังจากลูกค้าบันทึกที่อยู่แล้วลูกค้าสามารถกลับไปเล่นเกมกี่ครั้งก็ได้แต่ว่าจะไม่สามาถรรับรางวัลได้เพราะว่ามีสถานะ finish:true 




กิจกรรมนี้อยู่แค่ 7-10 วันเองช่วงตรุษจีน ผู้เล่นไม่เกิน 500 คน น่าจะใช้แผนฟรีสบาย

แก้ไขเพิ่มเติม  ป้องกัน human error

ฝั่งลูกค้า
1. ถ้าลูกค้าเล่นจบเกมไปแล้วแต่ยังไม่ได้รับรางวัลแล้วกดกลับมากน้าเกม หน้าเกมจะแสดง popup สกอร์จบเกมและสามารถกด รับรางวัล เพื่อพาลูกค้าไปกดเปิดซองอังเปาได้ 
2. เมื่อลูกค้า กดเปิดซองอังเปาไปแล้ว แต่ออกจากหน้าเว็บไปแล้ว ถ้าเข้ามาหน้าเปิดซองอังเปา จะขึ้น popup ที่ได้รับรางวัลแล้ว สามารถกดเข้าไปกรอกข้อมูลได้ เพื่อป้องกันลูกค้า เปิดซองซ้ำ
3. หน้ากรอกข้อมูลรับรางวัล ชื่อ นามสกุล เบอร์โทร กรอกให้ลูกค้าอัตโนมัติโดยการเช็คจากลิ้งค์ ?u= แล้วเอาข้อมูลใน D1 มาใส่อัตโนมัติเพื่อความสะดวก (แต่ลูกค้าสามารถแก้ เองได้เผื่อจะเปลี่นข้อมูลที่จัดส่ง)

ฝั่งแอดมิน
1. หน้า /admin/index.html
- เอาช่อง ลิ้งค์กับปุ่มคัดลอกลิ้งออก
- ต้องเพิ่มข้อมูลก่อน ถึงจะคัดลอกลิ้งก์ได้ (ป้องกัน ยูสเซอร์ซ้ำ)
- เพิ่มปุ่มคัดลอกไว้ที่ userTable
- สถานะ finish และ claimed ให้ทำเป็น icon ติ๊กถูก กับ - (ที่ช่อง claimed ถ้าหากเป็นติ๊กถูก คลิกแล้ว จะแสดง popup ข้อมูล ยูสเซอร์ ชื่อ เบอร์โทร ที่อยู่ ขอ popup ในหน้าเว็บ ไม่ใช่ popup ที่เบราเซอร์ จะได้คัดลอกได้)

เสร็จแล้ว อัพขึ้น repo , deploy ขึ้น page ให้ด้วย THX